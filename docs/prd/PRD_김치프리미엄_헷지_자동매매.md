# 김치프리미엄 기반 1:1 헷지 자동매매 시스템 PRD

> **문서 버전:** v1.0
> **작성일:** 2025-12-09
> **상태:** 검토 필요

---

## 1. 프로젝트 개요

### 1.1 목적
김치프리미엄(Kimchi Premium)을 기준으로 업비트 현물 매수와 해외 선물 숏 포지션을 **1:1 체결 수량 기준**으로 자동 헷지하는 개인·소수 사용자 전용 자동매매 시스템 개발

### 1.2 핵심 특징
- 서버에서 계산된 `kimchi` 값만을 기준으로 동작
- 업비트 실제 체결 수량을 기준으로 해외 포지션 1:1 헷지
- 완전 자동 진입·익절·손절·롤백 구조
- **Windows 전용 로컬 실행 프로그램(EXE)**
- **개발 언어: C#**

### 1.3 비목적 (Out of Scope)
- 상업용 SaaS, 대중 서비스, 봇 마켓 판매 목적 아님
- 웹 서비스 아님
- 다중 사용자 대시보드 없음

---

## 2. 시스템 아키텍처

### 2.1 서버 역할
| 기능 | 설명 |
|------|------|
| 데이터 수집 | 업비트 BTC/KRW 최근 체결가(trade_price) |
| 데이터 수집 | BingX BTCUSDT 최근 체결가(Last Price) |
| 계산 | 환율(USDT → KRW) |
| 계산 | 김치프리미엄(kimchi) 1초 단위 |
| 전송 | Webhook 또는 API 방식으로 EXE에 JSON 전송 |

**서버 응답 JSON 스펙:**
```json
{
  "kimchi": 3.21,
  "upbit": 102300000,
  "global": 70300,
  "timestamp": 1700000000
}
```

> ⚠️ **중요:** 서버는 진입값·익절값·손절값을 **절대 전달하지 않으며**, 오직 kimchi 값만 제공

### 2.2 클라이언트(EXE) 역할
- 사용자 로그인 및 라이센스 인증
- 진입값·익절값·손절값·진입 비율·레버리지·쿨다운 시간 설정
- 김프 수신 및 조건 비교
- 업비트/BingX/Bybit 주문 실행
- 손익 계산 및 실시간 표시
- 로그 저장

---

## 3. 자동매매 핵심 로직

### 3.1 진입 로직
```
조건: kimchi >= 진입값 (최초 만족 시점)
```
**실행 순서:**
1. 업비트 BTC/KRW 시장가 매수 실행
2. 업비트 체결 완료 후 `executedVolume` 확보
3. 동일 BTC 수량으로 해외 BTCUSDT Perpetual 시장가 숏 진입
4. 레버리지: 사용자 설정값(1~2배)

### 3.2 익절 로직
```
조건: kimchi <= 익절값
```
**실행:**
- 업비트 BTC 전량 시장가 매도
- 해외 거래소 숏 포지션 전량 시장가 청산

### 3.3 손절 로직 (강제 롤백)
```
조건: kimchi >= 손절값
```
**실행:**
- 업비트 BTC 전량 시장가 매도
- 해외 거래소 숏 포지션 전량 시장가 청산
- **완전 롤백 방식** (부분 청산 없음)

### 3.4 주문 실패 처리
| 상황 | 처리 |
|------|------|
| 업비트 매수 실패 | 해외 숏 주문 시도하지 않음 |
| 해외 숏 주문 실패 | 업비트 즉시 전량 시장가 매도 |
| 체결 수량 불일치 | 추가 주문 또는 부분 청산으로 강제 1:1 동기화 |

### 3.5 쿨다운
- 익절, 손절, 롤백 종료 직후 쿨다운 적용
- 쿨다운 동안 신규 자동 진입 완전 차단
- 쿨다운 종료 후 다시 진입 대기 상태로 복귀

---

## 4. 사용자 입력 항목

### 4.1 입력 가능 항목
| 항목 | 타입 | 범위/단위 |
|------|------|-----------|
| 진입 kimchi 값 | float | % |
| 익절 kimchi 값 | float | % |
| 손절 kimchi 값 | float | % |
| 시드 대비 진입 비율 | float | % |
| 레버리지 배율 | float | 1~2배 |
| 쿨다운 시간 | int | 초/분 |

### 4.2 입력 불가 항목
- 업비트 매수 수량
- 해외 숏 수량
- 헷지 비율

---

## 5. 인증 및 권한 구조

### 5.1 사용자 인증
- 이메일 + 비밀번호 로그인
- 서버 인증 성공 시 Access Token 발급
- EXE 실행 시마다 라이센스 및 만료일 검증
- 만료 또는 차단 계정: 자동매매 기능 비활성화

### 5.2 관리자 기능
- 사용자 승인/차단
- 라이센스 만료일 설정

---

## 6. 보안 정책

| 정책 | 상세 |
|------|------|
| API Key 저장 | AES-256 이상 암호화 |
| 평문 저장 | **금지** |
| 통신 | HTTPS만 허용 |
| 실행 권한 | 인증 서버 승인 시에만 활성화 |

---

## 7. 손익 계산 및 표시

### 7.1 실시간 표시 항목
- 업비트 BTC 보유량
- BingX 또는 Bybit USDT 잔액
- 미실현 손익
- 최근 1회 확정 손익
- 누적 확정 손익

### 7.2 손익 계산 기준
- 업비트 실체결 내역
- 해외 선물 실체결 내역
- **모든 수수료 포함**

---

## 8. 로그 시스템

**자동 저장 로그 항목:**
- 프로그램 실행/종료
- 로그인/인증 결과
- 진입·익절·손절 발생 시점
- 주문 성공/실패 내역
- 롤백 발생 여부
- 네트워크·API 오류

---

## 9. 지원 거래소

| 구분 | 거래소 | 마켓 |
|------|--------|------|
| 현물 | 업비트 | BTC/KRW |
| 선물 (기본) | BingX | BTCUSDT Perpetual |
| 선물 (확장) | Bybit | BTCUSDT Perpetual |

---

## 10. 기술 스택

| 구분 | 기술 |
|------|------|
| 언어 | C# |
| 플랫폼 | Windows (EXE) |
| UI 프레임워크 | WPF 또는 WinForms (TBD) |
| 암호화 | AES-256 |
| 통신 | HTTPS (REST API / WebSocket) |

---

## 최종 요약

> 본 프로젝트는 서버에서 제공하는 김치프리미엄(kimchi)을 기준으로
> 업비트 현물과 해외 선물 포지션을 체결 수량 기준 1:1로 자동 헷지하며,
> 진입·익절·손절·롤백·쿨다운까지 완전 자동으로 수행하는
> **C# 기반 Windows 전용 개인 자동매매 시스템** 개발 프로젝트이다.
